import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,e as t}from"./app-da553741.js";const p="/DaMaiCoding-Note/assets/image-20230616143835943-2550aaf6.png",o={},e=t(`<h1 id="前端文件流下载实现" tabindex="-1"><a class="header-anchor" href="#前端文件流下载实现" aria-hidden="true">#</a> 前端文件流下载实现</h1><h2 id="场景" tabindex="-1"><a class="header-anchor" href="#场景" aria-hidden="true">#</a> 场景</h2><p>后端传过来一个文件流，前端要如何进行下载保存呢</p><h2 id="实现" tabindex="-1"><a class="header-anchor" href="#实现" aria-hidden="true">#</a> 实现</h2><p>定义一个全局下载函数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 下载文件的方法</span>
<span class="token function-variable function">downLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> type<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 创建blob对象，解析流数据</span>
     <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
       <span class="token comment">// 设置返回的文件类型</span>
       <span class="token comment">// type: &#39;application/pdf;charset=UTF-8&#39; 表示下载文档为pdf，如果是word则设置为msword，excel为excel</span>
       <span class="token literal-property property">type</span><span class="token operator">:</span> type<span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 这里就是创建一个a标签，等下用来模拟点击事件</span>
     <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 兼容webkix浏览器，处理webkit浏览器中href自动添加blob前缀，默认在浏览器打开而不是下载</span>
     <span class="token keyword">const</span> <span class="token constant">URL</span> <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">;</span>
     <span class="token comment">// 根据解析后的blob对象创建URL 对象</span>
     <span class="token keyword">const</span> herf <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 下载链接</span>
     a<span class="token punctuation">.</span>href <span class="token operator">=</span> herf<span class="token punctuation">;</span>
     <span class="token comment">// 下载文件名,如果后端没有返回，可以自己写a.download = &#39;文件.pdf&#39;</span>
     a<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>
     document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 点击a标签，进行下载</span>
     a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 收尾工作，在内存中移除URL 对象</span>
     document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
     window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>herf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>调用方式</p><ol><li>先设置 <code>responseType: &quot;blob&quot;</code></li><li>获取 后端传过来的文件名</li><li>设置 文件类型</li><li>将 <strong>Blob 数据</strong>、<strong>文件类型</strong>、<strong>文件名</strong> 传进行函数中 (注意这样函数需要的数据，是 Blob 数据，不是后端直接传过来的所有数据流)</li></ol><figure><img src="`+p+`" alt="image-20230616143835943" tabindex="0" loading="lazy"><figcaption>image-20230616143835943</figcaption></figure><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 批量导出 (不要在意请求方式，知道核心内容即可)</span>
<span class="token function">ExportAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">&quot;blob&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 文件下载最重要的事 要设置 这个参数</span>
      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">communityId</span><span class="token operator">:</span> vc<span class="token punctuation">.</span><span class="token function">getCurrentCommunity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>communityId<span class="token punctuation">,</span> <span class="token comment">//小区ID</span>
        <span class="token literal-property property">chargingCodes</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
          vc<span class="token punctuation">.</span>component<span class="token punctuation">.</span>chargeTypeManger<span class="token punctuation">.</span>selectionArr
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    vc<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
      <span class="token string">&quot;ExportAndExportChargingTypeComponent&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;exportData&quot;</span><span class="token punctuation">,</span>
      param<span class="token punctuation">,</span>
      <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">json<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取后端传过来的文件名</span>
        <span class="token keyword">const</span> fileName <span class="token operator">=</span> res<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>map<span class="token punctuation">[</span><span class="token string">&quot;content-disposition&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
          <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
          <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;filename=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 文件类型设置</span>
        <span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token string">&quot;application/excel;charset=UTF-8&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 文件流数据</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        vc<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">downLoad</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">errInfo<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败处理&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10),c=[e];function i(l,u){return s(),a("div",null,c)}const d=n(o,[["render",i],["__file","前端文件流下载实现.html.vue"]]);export{d as default};
